{"version":3,"file":"cookie-73492d56.js","sources":["../../../../node_modules/nuxt/dist/app/composables/cookie.mjs"],"sourcesContent":["import { ref, watch } from \"vue\";\nimport { parse, serialize } from \"cookie-es\";\nimport { appendHeader } from \"h3\";\nimport destr from \"destr\";\nimport { isEqual } from \"ohash\";\nimport { useNuxtApp } from \"../nuxt.mjs\";\nimport { useRequestEvent } from \"./ssr.mjs\";\nconst CookieDefaults = {\n  path: \"/\",\n  watch: true,\n  decode: (val) => destr(decodeURIComponent(val)),\n  encode: (val) => encodeURIComponent(typeof val === \"string\" ? val : JSON.stringify(val))\n};\nexport function useCookie(name, _opts) {\n  const opts = { ...CookieDefaults, ..._opts };\n  const cookies = readRawCookies(opts) || {};\n  const cookie = ref(cookies[name] ?? opts.default?.());\n  if (process.client) {\n    const callback = () => {\n      writeClientCookie(name, cookie.value, opts);\n    };\n    if (opts.watch) {\n      watch(cookie, callback, { deep: opts.watch !== \"shallow\" });\n    } else {\n      callback();\n    }\n  } else if (process.server) {\n    const nuxtApp = useNuxtApp();\n    const writeFinalCookieValue = () => {\n      if (!isEqual(cookie.value, cookies[name])) {\n        writeServerCookie(useRequestEvent(nuxtApp), name, cookie.value, opts);\n      }\n    };\n    const unhook = nuxtApp.hooks.hookOnce(\"app:rendered\", writeFinalCookieValue);\n    nuxtApp.hooks.hookOnce(\"app:redirected\", () => {\n      unhook();\n      return writeFinalCookieValue();\n    });\n  }\n  return cookie;\n}\nfunction readRawCookies(opts = {}) {\n  if (process.server) {\n    return parse(useRequestEvent()?.req.headers.cookie || \"\", opts);\n  } else if (process.client) {\n    return parse(document.cookie, opts);\n  }\n}\nfunction serializeCookie(name, value, opts = {}) {\n  if (value === null || value === void 0) {\n    return serialize(name, value, { ...opts, maxAge: -1 });\n  }\n  return serialize(name, value, opts);\n}\nfunction writeClientCookie(name, value, opts = {}) {\n  if (process.client) {\n    document.cookie = serializeCookie(name, value, opts);\n  }\n}\nfunction writeServerCookie(event, name, value, opts = {}) {\n  if (event) {\n    appendHeader(event, \"Set-Cookie\", serializeCookie(name, value, opts));\n  }\n}\n"],"names":[],"mappings":";;;;;;AAOA,MAAM,iBAAiB;AAAA,EACrB,MAAM;AAAA,EACN,OAAO;AAAA,EACP,QAAQ,CAAC,QAAQ,MAAM,mBAAmB,GAAG,CAAC;AAAA,EAC9C,QAAQ,CAAC,QAAQ,mBAAmB,OAAO,QAAQ,WAAW,MAAM,KAAK,UAAU,GAAG,CAAC;AACzF;AACO,SAAS,UAAU,MAAM,OAAO;;AACrC,QAAM,OAAO,EAAE,GAAG,gBAAgB,GAAG,MAAK;AAC1C,QAAM,UAAU,eAAe,IAAI,KAAK,CAAA;AACxC,QAAM,SAAS,IAAI,QAAQ,IAAI,OAAK,UAAK,YAAL,8BAAgB;AAUzB;AACzB,UAAM,UAAU;AAChB,UAAM,wBAAwB,MAAM;AAClC,UAAI,CAAC,QAAQ,OAAO,OAAO,QAAQ,IAAI,CAAC,GAAG;AACzC,0BAAkB,gBAAgB,OAAO,GAAG,MAAM,OAAO,OAAO,IAAI;AAAA,MACrE;AAAA,IACP;AACI,UAAM,SAAS,QAAQ,MAAM,SAAS,gBAAgB,qBAAqB;AAC3E,YAAQ,MAAM,SAAS,kBAAkB,MAAM;AAC7C;AACA,aAAO,sBAAqB;AAAA,IAClC,CAAK;AAAA,EACF;AACD,SAAO;AACT;AACA,SAAS,eAAe,OAAO,IAAI;;AACb;AAClB,WAAO,QAAM,qBAAe,MAAf,mBAAmB,IAAI,QAAQ,WAAU,IAAI,IAAI;AAAA,EAG/D;AACH;AACA,SAAS,gBAAgB,MAAM,OAAO,OAAO,CAAA,GAAI;AAC/C,MAAI,UAAU,QAAQ,UAAU,QAAQ;AACtC,WAAO,UAAU,MAAM,OAAO,EAAE,GAAG,MAAM,QAAQ,GAAE,CAAE;AAAA,EACtD;AACD,SAAO,UAAU,MAAM,OAAO,IAAI;AACpC;AAMA,SAAS,kBAAkB,OAAO,MAAM,OAAO,OAAO,CAAA,GAAI;AACxD,MAAI,OAAO;AACT,iBAAa,OAAO,cAAc,gBAAgB,MAAM,OAAO,IAAI,CAAC;AAAA,EACrE;AACH;","x_google_ignoreList":[0]}